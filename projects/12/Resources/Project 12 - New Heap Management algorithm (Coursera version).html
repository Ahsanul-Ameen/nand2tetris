<!DOCTYPE html>
<!-- saved from url=(0128)http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/New-Heap-Management-algorithm-Coursera-version-td4032026.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
					<meta name="viewport" content="width=device-width,initial-scale=1.0">
					
					<link rel="stylesheet" href="./Project 12 - New Heap Management algorithm (Coursera version)_files/nabble.css" type="text/css">
	<link rel="stylesheet" href="./Project 12 - New Heap Management algorithm (Coursera version)_files/NamlServlet.jtp" type="text/css">
<style type="text/css">
@media (max-width: 600px) {
#search-box,#topic-search-box{margin:1em 0}
td.pin-column img{display:none}
}
</style>
					<script async="" src="./Project 12 - New Heap Management algorithm (Coursera version)_files/analytics.js"></script><script src="./Project 12 - New Heap Management algorithm (Coursera version)_files/jquery-1.9.1.min.js"></script>
	<script>$.browser = {}</script>
	<script src="./Project 12 - New Heap Management algorithm (Coursera version)_files/nabbledropdown-2.4.1.js" type="text/javascript"></script>
	<script src="./Project 12 - New Heap Management algorithm (Coursera version)_files/NamlServlet(1).jtp" type="text/javascript"></script>
					<script type="text/javascript">
		var terms = Nabble.getSearchTerms();
		var hasTurnOff = false;
		Nabble.searchHighlight = function($elem) {
			if (terms != null && terms.length > 0) {
				$elem.each(function() {
					Nabble.highlightSearchTerms(terms, this);
				});
				if (Nabble.hasHighlightedTerms && !hasTurnOff) {
					var turnOffLink = '<span id="turn-off-highlight-control"><span class="highlight">&nbsp;X&nbsp;</span> ';
					turnOffLink += '<a href="javascript:void(0)" onclick="Nabble.turnOffHighlight()">Turn off highlighting</a></span>';
					$('#topics-controls-right').prepend(turnOffLink);
					hasTurnOff = true;
				}
			}
		};
		Nabble.turnOffHighlight = function() {
			Nabble.deleteCookie("query");
			Nabble.deleteCookie("searchuser");
			Nabble.deleteCookie("searchterms");
			$('span.search-highlight').removeClass('bold highlight');
			$('#turn-off-highlight-control').hide();
		};
	</script>
	<script type="text/javascript">
		Nabble.messageTextWidth();
	</script>
	<style>
		@media (max-width: 600px) {
			div.topics-controls-wrapper{margin:1.2em 0 7em !important}
			div.root-text img,div.message-text img{max-width:100%}
		}
	</style>
			<script type="text/javascript"> $(document).ready(function() { Nabble.searchHighlight($('h2.post-subject,div.message-text')); }); </script> <script type="text/javascript"> var _hash = Nabble.hash(); if (_hash) { (function(){ var post = _hash.substr(2); var allPosts = [4032026]; var allURLs = ["/New-Heap-Management-algorithm-Coursera-version-td4032026.html"]; var iPost = allPosts.indexOf(parseInt(post)); var lower = 0; var upper = lower + 20; if (iPost != -1 && (iPost < lower || iPost >= upper)) location.replace(allURLs[Math.floor(iPost/20)]+_hash); })(); } $(document).ready(function() { var rootId = '4032026'; var currentPostId = rootId; var isChangingViews = _hash == '#none'; if (_hash && !isChangingViews) currentPostId = _hash.substr(2); Nabble.hideQuotes(); function scrollToSelectedPost() { var $arrow = $('#red-arrow'+currentPostId).show(); if ($arrow.size() > 0) { var isRootPost = currentPostId == rootId; if (Nabble.isEmbedded) { if (Nabble.canScroll()) scrollTo(0, 0); var y = isChangingViews? null : isRootPost? 1 : $arrow.parents('div.classic-row').offset().top; Nabble.resizeFrames('', y); } else if (Nabble.canScroll() && !isRootPost) { var yPos = $arrow.offset().top; scrollTo(0,yPos-20); } } else { if (Nabble.isEmbedded && Nabble.canScroll()) { Nabble.resizeFrames('', 1); } else { var tb = $('div.top-bar').get(0); if (tb) tb.scrollIntoView(); } } }; $(window).load(scrollToSelectedPost); if (Nabble.isEmbedded) { $('div.message-text img').load(Nabble.resizeFrames); } }); </script> <style type="text/css"> div.classic-header { height:2.2em; clear:both; overflow:hidden; } div.classic-author-name { float:left; width: 140px; overflow: hidden; text-align:center; font-weight:bold; } div.classic-subject-line { left:.5em; overflow:hidden; height:1.3em; position:relative; } div.classic-right-menu { float:right; padding-left:1em; } div.classic-bar { padding:.5em .3em; clear:both; height:1.8em; } table.classic-body { border-collapse:collapse; margin-bottom:1em; table-layout: fixed; width:100%; } td.classic-author { vertical-align: top; text-align:center; width:140px; padding-bottom:1em; } td.classic-message { vertical-align:top; padding:1em; } div.message-text { cursor:text; overflow-x:auto; } div.avatar-inner { margin-left:20px; } div.avatar-outer { width:140px; text-align:left; } div.avatar-label { white-space:nowrap; font-size:80%; } </style> <style type="text/css"> @media (max-width: 600px) { #topic-search-box{float:none} img.avatar{width:30%;height:30%} td.classic-author{width:55px;font-size:11px;overflow:hidden} div.avatar-inner{margin:5px} div.classic-author-name{width:auto} div.ad > div,div.ad > ins{float:none !important;margin-left:-70px !important} div.classic-header{overflow:visible} div.classic-bar{height:3.5em} div.classic-subject-line{margin:2em 0;left:0;overflow-x:hidden;overflow-y:visible} table.classic-body{margin-top:2em} } </style>

	<title>Project 12 - New Heap Management algorithm (Coursera version)</title>
			<meta name="description" content="New Heap Management algorithm (Coursera version). Coursera part 2 introduces a slight variation of the Heap Management algorithm presented in the book. The significant changes are The size field...">
			<meta name="keywords" content="new, heap, management, algorithm, coursera, version, part, 2, introduces, slight, variation, presented, book, significant, changes, size, field, segment, headers, has, changed, project, 12, operating, system, nand2tetris, questions, answers, forum">
			<style type="text/css">
			#search-box-dropdown {
				text-align:left;
				position:absolute;
				display:none;
				z-index:1000;
				overflow:hidden;
			}
		</style>
		<script type="text/javascript">
			$(document).ready(function() {
				var $sdd = $('#search-box-dropdown');
				var $sb = $('#search-input');
				var $form = $sb.parent();
				var timeout;
				$(document).click(function(o){
					var $target = $(o.target);
					if ($target.parents().hasClass('search-box-dropdown')) {
						clearTimeout(timeout);
						$sb.focus();
					}
				});
				$sb.focusin(function(e) {
					$sdd.css('left', $sb.position().left - 5);
					$sdd.width($sb.outerWidth() + 10);
					$sdd.show();
				});
				$sb.focusout(function() {
					timeout = setTimeout(function() {
						$sdd.hide();
					},250);
				});
				$('input[type=radio]', $sdd).change(function() {
					var nodeId = $(this).val();
					$('input[name="node"]', $form).val(nodeId);
				});
				$('input[name="node"]', $form).val(32033);
			});
		</script><script type="text/javascript">
			Nabble.setView = function(view,url,post) {
				Nabble.setVar("tview",view);
				if (url.indexOf('#') == -1)
					url += '#none';
				location.replace(url);
			};
		</script><style type="text/css"> div.nabble-tooltip, div.nabble-tooltip * { color: #EEE; font-weight:bold; } div.nabble-tooltip { background: #000; font-size:90%; line-height:normal; display: none; position: absolute; z-index: 88888; padding: .5em; border: 1px solid #FFF; white-space:normal; -moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px; } div.nabble-tooltip-small-row, div.nabble-tooltip-small-row * { color:#D0EAF2; } div.nabble-tooltip-small-row { font-size:80%; font-weight:normal; padding-top: .4em; } div.nabble-tooltip-arrow { font: 40px Arial, Sans-serif; line-height:1em; left:15px; position:absolute; bottom:-15px; height:15px; width:30px; overflow:hidden; } div.nabble-tooltip-arrow div { position:absolute; } div.nabble-tooltip-arrow div.d1 { top:-22px; color: #FFF; } div.nabble-tooltip-arrow div.d2 { top:-25px; color: #000; } </style> <script type="text/javascript"> Nabble.startTooltip = function(e, position, delay) { if (e.nabbletooltip) return; e.nabbletooltip = true; var $this = $(e); var $arrow = $this.children().last(); var $elem = $this.prev(); $elem.hover( function() { setTip(); setTimer(); }, function() { stopTimer(); $this.hide(); } ); function setTimer() { $this.showTipTimer = setTimeout(function() { $('div.nabble-tooltip').hide(); stopTimer(); $this.fadeTo('fast', .8); }, delay); }; function stopTimer() { clearInterval($this.showTipTimer); }; function setTip(){ if ($this.parent().get() != document.body) $(document.body).append($this); var useTitle = $this.attr('use_title') == 'true'; if (useTitle) { var title = $elem.attr('title'); if (title != '') { $arrow.remove(); $this.html(title); $elem.attr('title',''); $this.append($arrow); } } var win = $(window).width(); if (position == 'up') { var w = $this.outerWidth(); if (w > 250) { w = 250; $this.width(w); } var xMid = $elem.offset().left + $elem.outerWidth()/2; var xTip = xMid - w/2; if (xTip+w > win-5) xTip = win-w-5; if (xTip < 0) xTip = 0; var xArrow = xMid-xTip-11; var yTip = $elem.offset().top-$this.outerHeight()-12; $arrow.css('left', xArrow); $this.css({'top' : yTip, 'left' : xTip}); } else if (position == 'right') { var h = $this.outerHeight(); var yMid = $elem.offset().top + $elem.outerHeight()/2; var yTip = yMid - h/2; var xTip = $elem.offset().left + $elem.outerWidth() + 10; $arrow.width(8).height(24).css({bottom:0,left:-8}); var yArrow = (h - 24)/2; $arrow.css({top:yArrow}); var $d1 = $arrow.children().first(); var $d2 = $arrow.children().last(); $d1.css({top:-11}); $d2.css({top:-11,left:1}); $this.css({'top' : yTip, 'left' : xTip}); } }; }; </script><script type="text/javascript">
			Nabble.pinTopic = function(id) {
				var call = '/' + 'template/NamlServlet.jtp?macro=pin_topic&node=' + id;
				$.getScript(call, function() {
					$('#pin-icon').show();
					NabbleDropdown.show('unpinTopic');
					NabbleDropdown.hide('pinTopic');
					alert('This topic has been pinned.');
				});
			};
		</script><script type="text/javascript">
			Nabble.unpinTopic = function(id) {
				var call = '/'+'template/NamlServlet.jtp?macro=unpin_topic&node=' + id;
				$.getScript(call, function() {
					$('#pin-icon').hide();
					NabbleDropdown.hide('unpinTopic');
					NabbleDropdown.show('pinTopic');
					alert('This topic has been unpinned.');
				});
			};
		</script><script type="text/javascript">
			Nabble.lockTopic = function(id) {
				var call = '/'+'template/NamlServlet.jtp?macro=lock_topic&node=' + id;
				$.getScript(call, function() {
					$('#lock-icon').show();
					NabbleDropdown.show('unlockTopic');
					NabbleDropdown.hide('lockTopic');
					alert('This topic has been locked.');
				});
			};
		</script><script type="text/javascript">
			Nabble.unlockTopic = function(id) {
				var call = '/'+'template/NamlServlet.jtp?macro=unlock_topic&node=' + id;
				$.getScript(call, function() {
					$('#lock-icon').hide();
					NabbleDropdown.hide('unlockTopic');
					NabbleDropdown.show('lockTopic');
					alert('This topic has been unlocked.');
				});
			};
		</script><script type="text/javascript">
			Nabble.nViews = function(id, views) {
				var $v = $('#v'+id);
				var pos = views=='1'?0:1;
				var t = $v.html()? $v.html().split('|')[pos]:'';
				$v.html(t == ''? views : t.replace(/%1/g,views)).show();
			};
		</script>
					<script type="text/javascript">
		Nabble.setFontSize();
		
	</script>
	<script type="text/javascript">
		if (Nabble.analytics) Nabble.analytics();
	</script><script src="./Project 12 - New Heap Management algorithm (Coursera version)_files/VisitCounter.jtp" type="text/javascript"></script>
	<!-- Start Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
		
		ga('create', 'UA-91855-9', 'auto', 'nabble');
		ga('nabble.send', 'pageview');
	</script>
	<!-- End Google Analytics -->
				</head>
				<body data-gr-c-s-loaded="true">
					<div id="notice" class="notice rounded-bottom"></div>
					<div class="nabble macro_classic_forum_topic" id="nabble">
						
			
			<div class="top-bar">
		<div class="breadcrumbs" style="float:left">
			<span id="breadcrumbs" class="weak-color">
		<a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/">Nand2Tetris Questions and Answers Forum</a>
						<span> › </span><a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/Operating-System-f32639.html">Operating System</a>
						<span> › </span>
				<a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/Project-12-f32641.html">Project 12</a>
	</span>
		</div>
		<div style="text-align:right;">
			<span style="white-space:nowrap;" id="nabble-user-header"><a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/template/NamlServlet.jtp?macro=login_page&amp;nextUrl=http%3A%2F%2Fnand2tetris-questions-and-answers-forum.32033.n3.nabble.com%2FNew-Heap-Management-algorithm-Coursera-version-td4032026.html">Login</a>&nbsp;&nbsp;<a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/template/NamlServlet.jtp?macro=start_registration_page&amp;nextUrl=http%3A%2F%2Fnand2tetris-questions-and-answers-forum.32033.n3.nabble.com%2FNew-Heap-Management-algorithm-Coursera-version-td4032026.html">Register</a></span>
	<script type="text/javascript">Nabble.userHeader();</script>
		</div>
	</div>
			
			<div id="nabble-newsflash" class="info-message" style="display:none;padding:.5em;margin-bottom:.5em"></div>
	
			<div id="topic-search-box" class="search-box float-right" style="padding:.5em 0">
		<form action="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/template/NamlServlet.jtp">
		<input type="hidden" name="macro" value="search_page">
		<input type="hidden" name="node" value="32033">
		
		
		
		<input id="search-input" name="query" size="18" class="medium-border-color">
		<div id="search-box-dropdown" class="search-box-dropdown light-bg-color drop-shadow border1 medium-border-color rounded-bottom">
		<div style="margin:.5em .5em 0 .5em">
					<b>Search</b><br>
					<input id="search-root-node" type="radio" name="n" value="32033" checked="true">
					<label for="search-root-node">everywhere</label><br>

					<input id="search-this-node" type="radio" name="n" value="4032026">
					<label for="search-this-node">
						only in this topic
					</label>
				</div>
		<div style="margin:.5em;line-height:2em">
			<input class="toolbar action-button float-right" type="submit" value="Search">
			<a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/template/NamlServlet.jtp?macro=adv_search_page&amp;node=4032026" rel="nofollow" style="font-size:80%">Advanced Search</a>
		</div>
	</div>
	</form>
	</div>

	<h1 id="post-title" class="adbayes-content" style="margin:0.25em 0 .8em">
		New Heap Management algorithm (Coursera version)
	</h1>
			<div class="topics-controls-wrapper" style="margin:1.2em 0 5em">
		<div id="topics-controls-left" class="float-left nowrap">
			<table>
		<tbody><tr>
			<td style="padding-right:.1em">
		<img src="./Project 12 - New Heap Management algorithm (Coursera version)_files/view-classic.gif" width="18" height="18" style="border:none" alt="classic">
	</td>

	<td style="padding-right:1.1em">
		Classic
	</td>

			<td style="padding-right:.1em">
		<a href="javascript:void(0)" onclick="Nabble.setView(&#39;list&#39;, &#39;/New-Heap-Management-algorithm-Coursera-version-tc4032026.html&#39;,null)"><img src="./Project 12 - New Heap Management algorithm (Coursera version)_files/view-list.gif" width="18" height="18" style="border:none" alt="list"></a>
	</td>

	<td style="padding-right:1.1em">
		<a href="javascript:void(0)" onclick="Nabble.setView(&#39;list&#39;, &#39;/New-Heap-Management-algorithm-Coursera-version-tc4032026.html&#39;,null)">List</a>
	</td>

			<td style="padding-right:.1em">
		<a href="javascript:void(0)" onclick="Nabble.setView(&#39;threaded&#39;, &#39;/New-Heap-Management-algorithm-Coursera-version-tt4032026.html&#39;,null)"><img src="./Project 12 - New Heap Management algorithm (Coursera version)_files/view-threaded.gif" width="18" height="18" style="border:none" alt="threaded"></a>
	</td>

	<td style="padding-right:1.1em">
		<a href="javascript:void(0)" onclick="Nabble.setView(&#39;threaded&#39;, &#39;/New-Heap-Management-algorithm-Coursera-version-tt4032026.html&#39;,null)">Threaded</a>
	</td>
		</tr>
	</tbody></table>
		</div>
		<div id="topics-controls-right" class="float-right nowrap" style="padding-top:.3em">
			<span style="padding-right:1em;height:21px">
		<img id="pin-icon" src="./Project 12 - New Heap Management algorithm (Coursera version)_files/pin.png" width="20" height="21" title="This topic has been pinned in Project 12." style="vertical-align:middle;">
		<div id="tooltip1546" class="nabble-tooltip" use_title="true">
		
		<div class="nabble-tooltip-arrow">
			<div class="d1">♦</div>
			<div class="d2">♦</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip1546'), 'up', 400);
	</script>
	</span>
	<span id="lock-icon" class="weak-color" style="padding:0 .5em;margin-right:.5em;display:none;">
		<img src="./Project 12 - New Heap Management algorithm (Coursera version)_files/lock_sm.png" width="10" height="15" style="vertical-align:middle"> Locked
	</span>
	<span style="padding-right:1em">
		1 message
	</span>
	<img src="./Project 12 - New Heap Management algorithm (Coursera version)_files/gear.png" class="image16" alt="Options">
	<span id="dd_topicdropdown"><span id="topicdropdown" class="dropdown"><a href="javascript:void(0)" title="Click for more options">Options</a> <img src="./Project 12 - New Heap Management algorithm (Coursera version)_files/more.png" width="10" height="10"><table class="light-bg-color medium-border-color drop-shadow" style="margin-top:1px;"><tbody><tr id="_loadingtopicdropdown" style="display:none"><td class="dropdown-simple-row"><span id="_loadingSpantopicdropdown">Loading...</span></td></tr><tr id="topicSubscriptionLink"><td style="border:none"><a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/template/NamlServlet.jtp?macro=subscribe&amp;node=4032026" rel="nofollow">Subscribe via email</a></td></tr><tr class="dropdown-separator"><td class="action-separator medium-border-color">&nbsp;</td></tr><tr id="moveTopic" style="display:none"><td style="border:none"><a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/template/NamlServlet.jtp?macro=move_node&amp;node=4032026" rel="nofollow">Move topic</a></td></tr><tr id="pinTopic" style="display:none"><td style="border:none"><a href="javascript: void Nabble.pinTopic(4032026)" rel="nofollow">Pin topic</a></td></tr><tr id="unpinTopic" style="display:none"><td style="border:none"><a href="javascript: void Nabble.unpinTopic(4032026)" rel="nofollow">Unpin topic</a></td></tr><tr id="lockTopic" style="display:none"><td style="border:none"><a href="javascript: void Nabble.lockTopic(4032026)" rel="nofollow">Lock topic</a></td></tr><tr id="unlockTopic" style="display:none"><td style="border:none"><a href="javascript: void Nabble.unlockTopic(4032026)" rel="nofollow">Unlock topic</a></td></tr><tr id="deleteRecursively" style="display:none"><td style="border:none"><a href="javascript: void(0)" onclick="Nabble.deleteFromSite(4032026)" rel="nofollow">Delete this topic</a></td></tr><tr id="deletePost" style="display:none"><td style="border:none"><a href="javascript: void(0)" onclick="Nabble.deletePost(4032026)" rel="nofollow">Delete this topic</a></td></tr><tr id="changeMetaTags" style="display:none"><td style="border:none"><a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/template/NamlServlet.jtp?macro=change_title_and_meta_tags&amp;node=4032026" rel="nofollow">Change title and meta tags</a></td></tr><tr id="embedPost4032026"><td style="border:none"><a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/embed/EmbedOptions.jtp?node=4032026" rel="nofollow">Embed post</a></td></tr><tr id="permalink4032026"><td style="border:none"><a href="javascript: void(0)" onclick="prompt(&#39;Copy this:&#39;,&#39;http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/New-Heap-Management-algorithm-Coursera-version-tp4032026.html&#39;)">Permalink</a></td></tr></tbody></table></span></span>
	<script type="text/javascript">
		var dropdown = new NabbleDropdown("topicdropdown", "Options","Click for more options");
		
		dropdown.add('topicSubscriptionLink', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dsubscribe&amp;node\x3D4032026\" rel\x3D\"nofollow\"\x3ESubscribe via email\x3C/a\x3E');
		dropdown.addSeparator();
		dropdown.add('moveTopic', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dmove_node&amp;node\x3D4032026\" rel\x3D\"nofollow\"\x3EMove topic\x3C/a\x3E', 'display:none');
		dropdown.add('pinTopic', '\x3Ca href\x3D\"javascript: void Nabble.pinTopic(4032026)\" rel\x3D\"nofollow\"\x3EPin topic\x3C/a\x3E', 'display:none');
		dropdown.add('unpinTopic', '\x3Ca href\x3D\"javascript: void Nabble.unpinTopic(4032026)\" rel\x3D\"nofollow\"\x3EUnpin topic\x3C/a\x3E', 'display:none');
		dropdown.add('lockTopic', '\x3Ca href\x3D\"javascript: void Nabble.lockTopic(4032026)\" rel\x3D\"nofollow\"\x3ELock topic\x3C/a\x3E', 'display:none');
		dropdown.add('unlockTopic', '\x3Ca href\x3D\"javascript: void Nabble.unlockTopic(4032026)\" rel\x3D\"nofollow\"\x3EUnlock topic\x3C/a\x3E', 'display:none');
		dropdown.add('deleteRecursively', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deleteFromSite(4032026)\" rel\x3D\"nofollow\"\x3EDelete this topic\x3C/a\x3E', 'display:none');
			dropdown.add('deletePost', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deletePost(4032026)\" rel\x3D\"nofollow\"\x3EDelete this topic\x3C/a\x3E', 'display:none');
		dropdown.add('changeMetaTags', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dchange_title_and_meta_tags&amp;node\x3D4032026\" rel\x3D\"nofollow\"\x3EChange title and meta tags\x3C/a\x3E', 'display:none');
		dropdown.add('embedPost4032026', '\x3Ca href\x3D\"/embed/EmbedOptions.jtp?node\x3D4032026\" rel\x3D\"nofollow\"\x3EEmbed post\x3C/a\x3E');
		dropdown.add('permalink4032026', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"prompt(\'Copy this:\',\'http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/New-Heap-Management-algorithm-Coursera-version-tp4032026.html\')\"\x3EPermalink\x3C/a\x3E');
		dropdown.build('dd_topicdropdown');
		dropdown.loadOnClick('/template/NamlServlet.jtp?macro=topic_dropdown_later&node=4032026&_=' + Math.floor(Math.random()*999999));
	</script>
		</div>
	</div>
			<div id="topic-contents" style="margin-top:1em;clear:both">
		<div id="classic-contents">
		
		<div class="classic-row">
		<div class="classic-header">
			<div class="classic-bar shaded-bg-color rounded-top">
				<div class="classic-author-name nowrap">
					<a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=266121">cadet1620</a>
				</div>
				<div class="classic-right-menu shaded-bg-color weak-color">
					<a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/template/NamlServlet.jtp?macro=reply&amp;node=4032026" rel="nofollow">Reply</a> |
					<a href="javascript:void(0)" onclick="Nabble.setView(&#39;threaded&#39;, &#39;/New-Heap-Management-algorithm-Coursera-version-tt4032026.html&#39;,4032026)">Threaded</a>
	<div id="tooltip62847" class="nabble-tooltip" use_title="false">
		Open this post in threaded view
		<div class="nabble-tooltip-arrow">
			<div class="d1">♦</div>
			<div class="d2">♦</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip62847'), 'up', 400);
	</script> |
					<span id="dd_postdropdown4032026"><span id="postdropdown4032026" class="dropdown"><a href="javascript:void(0)" title="Click for more options">More</a> <img src="./Project 12 - New Heap Management algorithm (Coursera version)_files/more.png" width="10" height="10"><table class="light-bg-color medium-border-color drop-shadow" style="margin-top:1px;"><tbody><tr id="_loadingpostdropdown4032026" style="display:none"><td class="dropdown-simple-row"><span id="_loadingSpanpostdropdown4032026">Loading...</span></td></tr><tr id="replyToAuthor4032026" style="display:none"><td style="border:none"><a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/user/SendEmail.jtp?type=pm&amp;post=4032026" rel="nofollow">Reply to author</a></td></tr><tr id="editPost4032026" style="display:none"><td style="border:none"><a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/template/NamlServlet.jtp?macro=edit_post&amp;node=4032026" rel="nofollow">Edit post</a></td></tr><tr id="movePost4032026" style="display:none"><td style="border:none"><a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/template/NamlServlet.jtp?macro=move_node&amp;node=4032026" rel="nofollow">Move post</a></td></tr><tr id="deletePost4032026" style="display:none"><td style="border:none"><a href="javascript: void(0)" onclick="Nabble.deletePost(4032026)" rel="nofollow">Delete this post</a></td></tr><tr id="deleteRecursively4032026" style="display:none"><td style="border:none"><a href="javascript: void(0)" onclick="Nabble.deleteFromSite(4032026)" rel="nofollow">Delete this post and replies</a></td></tr><tr id="changePostDate4032026" style="display:none"><td style="border:none"><a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/template/NamlServlet.jtp?macro=change_post_date&amp;node=4032026" rel="nofollow">Change post date</a></td></tr><tr id="print4032026"><td style="border:none"><a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/template/NamlServlet.jtp?macro=print_post&amp;node=4032026" rel="nofollow">Print post</a></td></tr><tr id="permalink4032026"><td style="border:none"><a href="javascript: void(0)" onclick="prompt(&#39;Copy this:&#39;,&#39;http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/New-Heap-Management-algorithm-Coursera-version-tp4032026.html&#39;)">Permalink</a></td></tr><tr id="rawMail4032026" style="display:none"><td style="border:none"><a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/template/NamlServlet.jtp?macro=raw_mail&amp;node=4032026" rel="nofollow">Raw mail</a></td></tr></tbody></table></span></span>
	<script type="text/javascript">
		var dropdown = new NabbleDropdown("postdropdown4032026", "More","Click for more options");
		
		dropdown.add('replyToAuthor4032026', '\x3Ca href\x3D\"/user/SendEmail.jtp?type\x3Dpm&amp;post\x3D4032026\" rel\x3D\"nofollow\"\x3EReply to author\x3C/a\x3E', 'display:none');
		dropdown.add('editPost4032026', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dedit_post&amp;node\x3D4032026\" rel\x3D\"nofollow\"\x3EEdit post\x3C/a\x3E', 'display:none');
		dropdown.add('movePost4032026', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dmove_node&amp;node\x3D4032026\" rel\x3D\"nofollow\"\x3EMove post\x3C/a\x3E', 'display:none');
		dropdown.add('deletePost4032026', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deletePost(4032026)\" rel\x3D\"nofollow\"\x3EDelete this post\x3C/a\x3E', 'display:none');
			dropdown.add('deleteRecursively4032026', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deleteFromSite(4032026)\" rel\x3D\"nofollow\"\x3EDelete this post and replies\x3C/a\x3E', 'display:none');
		dropdown.add('changePostDate4032026', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dchange_post_date&amp;node\x3D4032026\" rel\x3D\"nofollow\"\x3EChange post date\x3C/a\x3E', 'display:none');
		dropdown.add('print4032026', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dprint_post&amp;node\x3D4032026\" rel\x3D\"nofollow\"\x3EPrint post\x3C/a\x3E');
		dropdown.add('permalink4032026', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"prompt(\'Copy this:\',\'http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/New-Heap-Management-algorithm-Coursera-version-tp4032026.html\')\"\x3EPermalink\x3C/a\x3E');
		dropdown.add('rawMail4032026', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Draw_mail&amp;node\x3D4032026\" rel\x3D\"nofollow\"\x3ERaw mail\x3C/a\x3E', 'display:none');
		dropdown.build('dd_postdropdown4032026');
		dropdown.loadOnClick('/template/NamlServlet.jtp?macro=post_dropdown_later&node=4032026&_=' + Math.floor(Math.random()*999999));
	</script>
				</div>
				<div class="classic-subject-line">
					<span id="red-arrow4032026" class="float-left invisible" style="margin-top: 0.2em; display: inline;">
		<img title="Selected post" width="15" height="15" src="./Project 12 - New Heap Management algorithm (Coursera version)_files/arrow.png" alt="Selected post">
	</span>
					<span class="post-date float-left">
		<span id="d1528049096605-843">Jun 04, 2018; 12:04am</span><script type="text/javascript">
		Nabble.get('d1528049096605-843').innerHTML= Nabble.formatDateLong(new Date(1528049096605));
	</script>
	</span>
					<h2 class="post-subject float-left adbayes-content" style="width:30%;overflow:visible;font-family:inherit">
		New Heap Management algorithm (Coursera version)
	</h2>
				</div>
			</div>
		</div>
		<table class="classic-body">
			<tbody><tr>
				<td class="classic-author shaded-bg-color rounded-bottom">
					<div class="avatar-outer">
		<div class="avatar-inner">
			<a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=266121" rel="nofollow" title="View profile of cadet1620" class="nowrap no-decoration"><img class="avatar medium-border-color" src="./Project 12 - New Heap Management algorithm (Coursera version)_files/avatar100.png" height="100" width="100" alt="cadet1620" title="cadet1620"><img src="./Project 12 - New Heap Management algorithm (Coursera version)_files/online.png" class="online266121 online invisible" title="User is online" alt="online"></a>

	
	
		</div>
	</div>
	<div class="avatar-label weak-color"><b>Administrator</b></div>
	
	<div class="post-count266121 avatar-label weak-color">2607 posts</div>
	
				</td>
				<td class="classic-message">
					
	
	
	<div id="message4032026" class="message-text adbayes-content">
		Coursera part 2 introduces a slight variation of the Heap Management algorithm presented in the book.
<p>
The significant changes are
</p><ul>
<li>The <i>size</i> field in the segment headers has changed to be the size of the segment's <i>data block</i> instead of the size of the segment itself.</li>
<li>Segments are <i>always</i> split into two segments when an allocated segment is returned from Memory.alloc().</li>
<li>The returned block contains a complete header. (In the book's algorithm, allocated segments have <i>size</i> as a single-word header.)</li>
</ul>
Also note the trivial change that the order of the <i>link</i> and <i>size</i> fields has been swapped.

<p>
</p><table style="margin-left:auto;margin-right:auto;">
<tbody><tr>

<!-- LEFT table -->
<td style="vertical-align: text-top;">
    <table style="border-collapse:collapse;">
    <!-- header -->
    <tbody><tr><td></td><td></td><td colspan="5" style="text-align:left;">Before alloc(5)</td>
    </tr>
    <tr><td>&nbsp;</td></tr>
    <!-- row 1 -->
    <tr><td>freeList</td><td>→</td>
        <td style="border:1px solid black;text-align:center;"><i>next</i></td><td>→</td>
        <td style="border:1px solid black;text-align:center;"><i>next</i></td><td>→</td>
        <td style="border:1px solid black;text-align:center;"><b>null</b></td>
    </tr>
    <!-- row 2 -->
    <tr><td></td><td></td>
        <td style="border:1px solid black;text-align:center;">2</td><td></td>
        <td style="border:1px solid black;text-align:center;">8</td><td></td>
        <td style="border:1px solid black;text-align:center;">3</td>
    </tr>
    <!-- row 3 -->
    <tr><td></td><td></td>
        <td style="border:1px solid black;">  </td><td></td>
        <td style="border:1px solid black;">  </td><td></td>
        <td style="border:1px solid black;">  </td>
    </tr>
    <!-- row 4 -->
    <tr><td></td><td></td>
        <td style="border:1px solid black;">&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td style="border:1px solid black;">&nbsp;</td>
    </tr>
    <!-- row 5 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td style="border:1px solid black;">&nbsp;</td>
    </tr>
    <!-- row 6 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 7 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 8 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 9 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 10 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>

    </tbody></table>
</td>

<!-- CENTER margin -->
<td>   </td>

<!-- RIGHT table -->
<td style="vertical-align:text-top;">
    <table style="border-collapse:collapse;">
    <!-- header -->
    <tbody><tr><td></td><td></td><td colspan="5" style="text-align:left;">After alloc(5)</td>
    </tr>
    <tr><td>&nbsp;</td></tr>
    <!-- row 1 -->
    <tr><td>freeList</td><td>→</td>
        <td style="border:1px solid black;text-align:center;"><i>next</i></td><td>→</td>
        <td style="border:1px solid black;text-align:center;"><i>next</i></td><td>→</td>
        <td style="border:1px solid black;text-align:center;"><b>null</b></td>
    </tr>
    <!-- row 2 -->
    <tr><td></td><td></td>
        <td style="border:1px solid black;text-align:center;">2</td><td></td>
        <td style="border:1px solid black;text-align:center;">1</td><td></td>
        <td style="border:1px solid black;text-align:center;">3</td>
    </tr>
    <!-- row 3 -->
    <tr><td></td><td></td>
        <td style="border:1px solid black;">  </td><td></td>
        <td style="border:1px solid black;">  </td><td></td>
        <td style="border:1px solid black;">  </td>
    </tr>
    <!-- row 4 -->
    <tr><td></td><td></td>
        <td style="border:1px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:1px solid black;">&nbsp;</td>
    </tr>
    <!-- row 5 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:1px solid black;">&nbsp;</td>
    </tr>
    <!-- row 6 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;text-align:center;"><b>null</b></td><td>*</td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 7 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;text-align:center;">5</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 8 -->
    <tr>    <td colspan="3" style="text-align:right;">
            returned block</td><td>→</td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 9 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 10 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 11 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 12 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <tr>
        <td colspan="7" style="text-align:left;">* See <i>Allocated block header</i><br>  section, below.</td>
    </tr><tr>
    </tr></tbody></table>
</td>

</tr>
<tr><td colspan="3" style="text-align:center;font-size: 90%;">
    <b>Figure 1: New Heap Management algorithm</b></td>
</tr>
</tbody></table>
<p>

</p><h4>Memory.alloc() changes</h4>

The search loop in Memory.alloc() remains the same—using either first-fit or best-fit, find a segment on the free list whose size is greater than or equal to the requested block size.
<p>
In the Book algorithm, once a large enough segment is found, the segment is either used in its entirety, or it is split into two segments.  If the entire segment is used, the segment must be removed from the free list.  This is a non-trivial operation because the search loop must keep track of two pointers during the linked-list search so that the segment that links to the segment to be removed can have its <i>next</i> pointer updated.
</p><p>
The Coursera algorithm vastly simplifies this by <b>always</b> spliting the found segment and using the newly created segment for the allocated block.  The found segment is reduced in size but is never removed from the free list.  <i>Another useful effect of always splitting segments for allocation is that the free list will never be empty; the </i>freeList<i> pointer will never be <b>null</b></i>.
</p><p>

</p><h4>Memory.deAlloc() changes</h4>

Memory.deAlloc() is simplified because the <i>size</i> field is already in the correct location and has the correct value.  The deallocated segment just needs to be returned to the free list.
<p>

</p><h4>Allocated block header</h4>

The Coursera algorithm sets the <i>next</i> pointer in the block header to <b>null</b>.  An improvement would be to set it to a <i>signature</i>, a known value that is neither <b>null</b> nor a legal pointer value.  This will allow dealloc() to check if the block being deallocated is an allocated block.  (Double deallocation is a common programming error.)
<p>
The simplest signature scheme is to set the <i>next</i> field to an easily recognizable value like -31416.  
</p><p>
An alternative is to set the <i>next</i> field to a value derived from the <i>block size</i>.  This would help prevent allocated blocks that had their header overwritten from being placed on the free list and corrupting the heap.  Setting the <i>block size</i> to not(block size) will form a suitable value that is an illegal address.  
</p><p>

</p><h4>Fragmentation</h4>

The Coursera algorithm is more susceptible to fragmentation than the Book algorithm because it always splits the heap segment that is used for a block allocation.  This means that a block that is deallocated will be too small to satisfy a request for another block of the same size.  A program that is repeatedly creating and disposing the same object will inevitably run out of memory.
<p>

</p><h4>Defragmentation</h4>

Defragmentation is not required by the course, but may be necessary if you want to run your game using your OS.  Here is a fairly easy way to do defragmentation in Memory.deAlloc().
<ul>
<li>Insert the deallocated segment into the free list in ascending <i>segment address</i> order.</li>
<li>After insertion, check if either or both the preceding segment or next segment is contiguous with the newly inserted segment; if so, combine the segments.</li>
</ul>
Another useful property of the Coursera Memory.alloc() algorithm is that because segments are always split and the unallocated portion remains on the free list, the initial segment—the segment at 2048—will always be present on the free list.  By maintaining the free list in address order, the first free segment will always be the 2048 segment and there will be no need for a special case to handle insertion at the head of the list.
<p>
To find the highest addressed segment that is less than the segment being deallocated, search the list for the first segment that has a <i>next</i> pointer that <b>null</b> or is greater that the deallocated segment's address.
</p><pre style="padding-left:2em;">deAlloc(Array o)
    segment = o-2   // Get heap segment from data block address
    
    prev_seg = free_list
    next_seg = prev_seg.next
    while next_seg != null and next_seg &lt; segment
        prev_seg = next_seg
        next_seg = prev_seg.next
</pre>
At this point, <i>prev_seg</i> is the segment before the insertion point and <i>next_seg</i> is the segment after the insertion point.  <b>WARNING: <i>next_seg</i> may be null.</b>
<p>
</p><table style="margin-left:auto;margin-right:auto;">
<tbody><tr>

<!-- LEFT table -->
<td style="vertical-align: text-top;">
    <table style="border-collapse:collapse;">
    <!-- header -->
    <tbody><tr><td></td><td></td><td colspan="5" style="text-align:left;">Before deAlloc(block)</td>
    </tr>
    <tr><td>&nbsp;</td></tr>
    <!-- row 0 -->
    <tr><td></td><td></td>
        <td style="text-align:center;">2048</td><td></td>
        <td style="text-align:center;">3000</td><td></td>
        <td style="text-align:center;">4000</td>
    </tr>
    <!-- row 1 -->
    <tr><td>freeList</td><td>→</td>
        <td style="border:1px solid black;text-align:center;"><i>next</i></td><td>→</td>
        <td style="border:1px solid black;text-align:center;"><i>next</i></td><td>→</td>
        <td style="border:1px solid black;text-align:center;"><b>null</b></td>
    </tr>
    <!-- row 2 -->
    <tr><td></td><td></td>
        <td style="border:1px solid black;text-align:center;">2</td><td></td>
        <td style="border:1px solid black;text-align:center;">1</td><td></td>
        <td style="border:1px solid black;text-align:center;">3</td>
    </tr>
    <!-- row 3 -->
    <tr><td></td><td></td>
        <td style="border:1px solid black;">  </td><td></td>
        <td style="border:1px solid black;">  </td><td></td>
        <td style="border:1px solid black;">  </td>
    </tr>
    <!-- row 4 -->
    <tr><td></td><td></td>
        <td style="border:1px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:1px solid black;">&nbsp;</td>
    </tr>
    <!-- row 5 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:1px solid black;">&nbsp;</td>
    </tr>
    <!-- row 5a -->
    <tr><td></td><td></td>
        <td style="text-align:center;">3003</td><td></td>
        <td>&nbsp;</td><td></td>
    </tr>
    <!-- row 6 -->
    <tr><td></td><td></td>
        <td style="border:2px solid black;text-align:center;"><i>sig.</i></td><td>*</td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 7 -->
    <tr><td></td><td></td>
        <td style="border:2px solid black;text-align:center;">5</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 8 -->
    <tr><td style="text-align:right;">block</td><td>→</td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 9 -->
    <tr><td></td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 10 -->
    <tr><td></td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 11 -->
    <tr><td></td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 12 -->
    <tr><td></td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <tr>
        <td colspan="7" style="text-align:left;">* See <i>Allocated block header</i><br>  section, above.</td>
    </tr><tr>
    </tr></tbody></table>
</td>

<!-- CENTER margin -->
<td>   </td>

<!-- Center table -->
<td style="vertical-align: text-top;">
    <table style="border-collapse:collapse;">
    <!-- header -->
    <tbody><tr><td></td><td></td><td colspan="7" style="text-align:left;">Insert into free list</td>
    </tr>
    <tr><td>&nbsp;</td></tr>
    <!-- row 0 -->
    <tr><td></td><td></td>
        <td style="text-align:center;">2048</td><td></td>
        <td style="text-align:center;">3000</td><td></td>
        <td style="text-align:center;">3003</td><td></td>
        <td style="text-align:center;">4000</td>
    </tr>
    <!-- row 1 -->
    <tr><td>freeList</td><td>→</td>
        <td style="border:1px solid black;text-align:center;"><i>next</i></td><td>→</td>
        <td style="border:1px solid black;text-align:center;"><i>next</i></td><td>→</td>
        <td style="border:2px solid black;text-align:center;"><i>next</i></td><td>→</td>
        <td style="border:1px solid black;text-align:center;"><b>null</b></td>
    </tr>
    <!-- row 2 -->
    <tr><td></td><td></td>
        <td style="border:1px solid black;text-align:center;">2</td><td></td>
        <td style="border:1px solid black;text-align:center;">1</td><td></td>
        <td style="border:2px solid black;text-align:center;">5</td><td></td>
        <td style="border:1px solid black;text-align:center;">3</td>
    </tr>
    <!-- row 3 -->
    <tr><td></td><td></td>
        <td style="border:1px solid black;">  </td><td></td>
        <td style="border:1px solid black;">  </td><td></td>
        <td style="border:2px solid black;">  </td><td></td>
        <td style="border:1px solid black;">  </td>
    </tr>
    <!-- row 4 -->
    <tr><td></td><td></td>
        <td style="border:1px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td style="border:1px solid black;">&nbsp;</td>
    </tr>
    <!-- row 5 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td>
    </tr>
    <!-- row 6 -->
    <tr><td colspan="3">prev_seg→3000</td><td></td>
        <td></td><td></td>
        <td style="border:2px solid black;"></td><td></td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 7 -->
    <tr><td colspan="3">next_seg→4000</td><td></td>
        <td></td><td></td>
        <td style="border:2px solid black;"></td><td></td>
        <td>&nbsp;</td>
    </tr>
    </tbody></table>
</td>

<!-- CENTER margin -->
<td>   </td>

<!-- RIGHT table -->
<td style="vertical-align: text-top;">
    <table style="border-collapse:collapse;">
    <!-- header -->
    <tbody><tr><td></td><td></td><td colspan="5" style="text-align:left;">After defragmentation</td>
    </tr>
    <tr><td>&nbsp;</td></tr>
    <!-- row 0 -->
    <tr><td></td><td></td>
        <td style="text-align:center;">2048</td><td></td>
        <td style="text-align:center;">3000</td><td></td>
        <td style="text-align:center;">4000</td>
    </tr>
    <!-- row 1 -->
    <tr><td>freeList</td><td>→</td>
        <td style="border:1px solid black;text-align:center;"><i>next</i></td><td>→</td>
        <td style="border:1px solid black;text-align:center;"><i>next</i></td><td>→</td>
        <td style="border:1px solid black;text-align:center;"><b>null</b></td>
    </tr>
    <!-- row 2 -->
    <tr><td></td><td></td>
        <td style="border:1px solid black;text-align:center;">2</td><td></td>
        <td style="border:1px solid black;text-align:center;">8</td><td></td>
        <td style="border:1px solid black;text-align:center;">3</td>
    </tr>
    <!-- row 3 -->
    <tr><td></td><td></td>
        <td style="border:1px solid black;">  </td><td></td>
        <td style="border:1px solid black;">  </td><td></td>
        <td style="border:1px solid black;">  </td>
    </tr>
    <!-- row 4 -->
    <tr><td></td><td></td>
        <td style="border:1px solid black;">&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td style="border:1px solid black;">&nbsp;</td>
    </tr>
    <!-- row 5 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td style="border:1px solid black;">&nbsp;</td>
    </tr>
    <!-- row 6 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 7 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 8 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 9 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>
    <!-- row 10 -->
    <tr><td></td><td></td>
        <td>&nbsp;</td><td></td>
        <td style="border:2px solid black;">&nbsp;</td><td></td>
        <td>&nbsp;</td>
    </tr>

    </tbody></table>
</td>

</tr>
<tr><td colspan="5" style="text-align:center;font-size: 90%;">
    <b>Figure 2: Deallocation with defragmentation</b></td>
</tr>
</tbody></table>
<p>
It is simple to insert the deallocated segment into the free list between <i>prev_seg</i> and <i>next_seg</i>
</p><pre style="padding-left:2em;">    prev_seg.next = segment
    segment.next = next_seg
</pre>
<p>
There are now three defragmentation cases that need to be handled.
</p><ol>
<li>The deallocated segment immediately follows <i>prev_seg</i>.</li>
<li><i>next_seg</i> immediately follows the deallocated segment.</li>
<li>All three segments are contiguous.</li>
</ol>
These three cases can be handled with two sequential operations
<pre style="padding-left:2em;">    // Combine segment with next_seg if contiguous.
    if (segment + segment.blockSize + 2) == next_seg
        segment.blockSize = segment.blockSize + next_seg.blockSize + 2;
        segment.next = next_seg.next;

    // Combine segment with prev_seg if contiguous.
    if (prev_seg + prev_seg.blockSize + 2) == segment
        prev_seg.blockSize = prev_seg.blockSize + segment.blockSize + 2;
        prev_seg.next = segment.next;
</pre>
<p>

</p><h4>Results</h4>

I wrote a test program that allocates 20 blocks randomly sized 200..600 words.  It then runs 10,000 passes randomly deallocating 5 of the blocks then reallocating 5 new blocks.  Increasing the block size by 25% (to 250..750) causes an allocation failure.<sup>[1]</sup>
<p>
</p><table style="margin-left:auto;margin-right:auto;">
  <tbody><tr><td>Block size 400&nbsp;± 50%<br>
  Heap after 10,000 passes.</td>
  <td>  </td>
  <td>Block size 500&nbsp;± 50%<br>
  Heap after allocation failure in pass 703.</td></tr>
  <tr><td style="vertical-align:text-top;"><pre>

 2048: free    (17) -&gt;  2524
 2067: alloc   455
 2524: free    (32) -&gt;  3147
 2558: alloc   222
 2782: alloc   363
 3147: free    (71) -&gt;  3465
 3220: alloc   243
 3465: free   (257) -&gt;  4130
 3724: alloc   404
 4130: free   (205) -&gt;  4555
 4337: alloc   216
 4555: free    (60) -&gt;  4870
 4617: alloc   251
 4870: free   (217) -&gt;  5308
 5089: alloc   217
 5308: free    (24) -&gt;  5858
 5334: alloc   522
 5858: free    (81) -&gt;  7122
 5941: alloc   317
 6260: alloc   445
 6707: alloc   413
 7122: free   (316) -&gt;  8062
 7440: alloc   307
 7749: alloc   311
 8062: free    (64) -&gt;  8896
 8128: alloc   381
 8511: alloc   383
 8896: free   (457) -&gt;  9790
 9355: alloc   433
 9790: free   (475) -&gt; 10860
10267: alloc   591
10860: free   (577) -&gt; 11939
11439: alloc   498
11939: free   (981) -&gt; 13394
12922: alloc   470
13394: free  (2962) -&gt;     0
16358: alloc    20
16380: alloc     2
</pre></td>
<td></td>
<td style="vertical-align:text-top;"><pre>
Allocation failure: 742 requested, largest available block 704.
 2048: free    (43) -&gt;  2960
 2093: alloc   515
 2610: alloc   348
 2960: free   (175) -&gt;  4100
 3137: alloc   574
 3713: alloc   385
 4100: free    (74) -&gt;  5243
 4176: alloc   334
 4512: alloc   729
 5243: free   (539) -&gt;  6396
 5784: alloc   610
 6396: free   (161) -&gt;  9199
 6559: alloc   635
 7196: alloc   680
 7878: alloc   731
 8611: alloc   586
 9199: free   (287) -&gt; 10723
 9488: alloc   525
10015: alloc   706
10723: free    (65) -&gt; 11408
10790: alloc   616
11408: free   (452) -&gt; 13714
11862: alloc   699
12563: alloc   607
13172: alloc   540
13714: free   (706) -&gt; 15760
14422: alloc   692
15116: alloc   642
15760: free   (596) -&gt;     0
16358: alloc    20
16380: alloc     2
</pre></td></tr>
</tbody></table>
<p>
</p><hr>
[1] If I did my math right, the mean and standard deviation for the sum of 20 uniform random integers is:
<table style="margin-left:4em;">
    <tbody><tr><th>Range</th><td> </td><th>Mean</th><td> </td><th>Std. Dev.</th><td> </td><th>+3 S.D.</th></tr>
    <tr><td>[200, 600]</td><td></td>
        <td style="text-align:right;">8000</td><td></td>
        <td style="text-align:right;">517.687</td><td></td>
        <td style="text-align:right;">9553.06</td></tr>
    <tr><td>[250, 750]</td><td></td>
        <td style="text-align:right;">10000</td><td></td>
        <td style="text-align:right;">646.787</td><td></td>
        <td style="text-align:right;">11940.36</td></tr>
</tbody></table>
  (Note that the failed test is trying to allocate a total of 11896 words which is about +2.9 sigma.)


	
	
	
	</div>
				</td>
			</tr>
		</tbody></table>
	</div>
	
		
	</div>
	</div>
			<div id="topic-footer" class="weak-color" style="padding-top:1em">
		«
		<a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/Project-12-f32641.html">Return to Project 12</a>
		&nbsp;|&nbsp;
		<span id="v4032026" style="">840 views</span>
	
	
	</div>
				
			<table class="footer-table shaded-bg-color">
		<tbody><tr>
			<td class="footer-left weak-color">
				<a href="http://www.nabble.com/" target="_top">Free forum by Nabble</a>
			</td>
			<td class="footer-right">
				<script>
		if( window.nbl_disableAdsLink && window.localStorage && !localStorage.nbl_noAds ) {
			document.write("<a href='javascript:localStorage.nbl_noAds=true;location.reload();'>"+nbl_disableAdsLink+"</a> | ");
		}
	</script>
				<a href="http://nand2tetris-questions-and-answers-forum.32033.n3.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&amp;id=classic_forum_topic%21nabble%3Atopic.naml&amp;base=nabble.view.web.template.ServletNamespace" rel="nofollow">Edit this page</a>
			</td>
		</tr>
	</tbody></table>
			<script type="text/javascript">
var scriptUrl = '/template/NamlServlet.jtp?macro=js_page&searchSpecial=4032026&incViewCount=4032026&newsflash=&visitorOnline=&avatarOnline=266121&postCount=266121&markVisited=4032026&views=4032026';
scriptUrl += '&_=' + Math.floor(Math.random()*9999);
$.getScript(scriptUrl, function() { Nabble.resizeFrames(); });
</script>

					</div>
					
					<!-- n3.nabble.com | Site ID = 32033 -->
				
			</body></html>